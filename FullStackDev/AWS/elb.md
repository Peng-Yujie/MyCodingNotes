# ELB

- Vertical Scaling: Increase the size of the instance
  - From t2.micro to t2.large
- Horizontal Scaling: Increase the number of instances
  - Auto scaling groups
  - Load balancers
- High Availability: ELB distributes incoming traffic across multiple targets
  - Auto scaling groups in multiple AZs

## Load Balancing

- Load balances are servers that forward internet traffic to multiple servers
- Why?
  - Spread load across multiple servers
  - Expose a single point of access (DNS) to the internet
  - Seamlessly handle failures
  - Do regualar health checks
  - Provide SSL termination

## Elastic Load Balancer (ELB)

- Managed service
- Automatically scales
- Supports multiple protocols
- Supports multiple types of load balancers

## Application Load Balancer (ALB)

- Layer 7 (HTTP) load balancer
- Great for **microservices** and **container-based** applications
- Routing tables to different target groups
  - Based on Path (.../users, .../posts)
  - Based on hostname (a.domain.com, b.domain.com)
  - Based on Query String (?color=red)
- Has a port mapping feature to redirect to a dynamic port in ECS

### DNS

By creating a load balancer, you get a DNS name that you can use to access the load balancer.

- When one of the instances fails, the load balancer will stop sending traffic to it, but other instances will still receive traffic.

### Rule

- Listener: A process that checks for connection requests
- Rule: Condition that checks for the path, hostname, or query string
  - Condition: Path is /error
  - Action: Forward to target group

## Network Load Balancer (NLB)

- Layer 4 (TCP) load balancer
- Great for **extreme performance** and **static IP** (Elastic IP) for your application
- Handle TCP, HTTP, HTTPS

### How to create a Network Load Balancer

1. Create a target group
2. Create a Network Load Balancer
3. Register targets to the target grou
4. Create a listener

## Gateway Load Balancer (GWLB)

GWLB is designed to support the deployment of third-party virtual appliances within your network architecture.

## Sticky Sessions

Same client will always go to the same instance

- Works for Classic Load Balancer, Application Load Balancer (ALB), and Network Load Balancer (NLB)
- Cookie-based (has an expiration date)
- May bring imbalance to the load

### Cookies

- Application-based cookies
  - Custom cookie
    - Generated by the target
    - Can include any custome attributs required by the application
    - Cookie name must be specified individually for each target group
    - Don't use AWSALB, AWSALBAPP, or AWSALBTG (reserved by AWS)
  - Application cookie
    - Generated by the load balancer
    - Name: AWSALBAPP
- Duration-based cookies
  - Generated by the load balancer
  - Name: AWSALB for ALB, AWSELB for Classic Load Balancer

### How to enable sticky sessions

`Target Group` -> `Actions` -> `Edit attributes` -> `Target selection configuration` -> `Stickiness` -> `Turn on stickiness` -> Select a type of stickiness -> Set a duration -> `Save`

## Cross-Zone Load Balancing

Distribute traffic evenly across all registered targets in all enabled AZs.

Suppose there are 10 instances in total, 2 in AZ1, and 8 in AZ2.

- Without cross-zone load balancing: 50% of the traffic goes to AZ1, and 50% goes to AZ2
- With cross-zone load balancing: 10% of the traffic goes to each instance

### types

- ALB: Always on, No charge
- NLB & GWLB: Disabled by default, charge for inter AZ data if enabled
- Classic Load Balancer: Disabled by default, no charge
